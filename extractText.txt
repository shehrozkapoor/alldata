DATASCIENCEANDDECISIONMAKING
1
LearningunderCovariateShiftintheData
(SupervisedLearning)
MaviyaTahsildar(1900870)
Abstract
ŠInanon-stationaryenvironment,wherethedataisstreamingormulti-domaindatamayresultinthechangein
data-processing.InpredictivemodellingacommonproblemthatoccursistheDatasetshiftwhenthereisadifferenceintheinputsand
theoutputsbetweenthetrainandtheteststages.AparticulardatashiftcaseistheCovariateshift,whichoccurswhenthereisashift
orchangeininputdistributioneventhoughthefunctionalrelationremainsunchanged.Inthisweseevarioustechniquestoimprovethe
learningforthedistributionwithcovariateshift.
F
1I
NTRODUCTION
I
N
anon-stationaryenvironment,thedatasetshifthas
beenignoredandassumedthatthetrainandthetest
distributionfollowthesameprobabilitydistributionin
supervisedlearningalgorithmswhichisratheranaive
assumption.Inreality,theproblemwiththedatasetshift
occursfrequently.Machinelearningbeingineveryaspect
ofthebusiness,computing,medicalscienceandsoon.
Thefactthatmostofthereal-worldapplicationsuselarge
chunksofdatainwhichtheymustcopeupwiththeshift
inthedata.Whichledtothegrowingamountofinterestin
thesefewyears.Therearevarioustechniquesormethods
insolvingtheproblemofdatasetshiftforexample;data
thatisobtainedformedicalpurposes.Acommonapproach
totacklethebiasforacovariateshiftisbyreweighting
thelossfunction.Underthecovariatedatasetshift,the
techniquesusedformodelselectionlikecrossvalidation
willnotworkasdesired.Thedistributionlosesitsproperty
ofunbiasedness.Theebelowshowsacovariatedata
shift.
Fig.1.IllustrationofaCovariateshift
2B
ACKGROUND
[1]Inthispapertherearevariousmethodsofdetecting
thedatasetshift,butthemainlimitationwithmostof
themethodswhichwerebasedonbatchprocessingwas
therequirementofsuperviseddata.Proposedanadaptive
learningalgorithmthatdetectsdatashiftusinganexpo-
nentialweightedmovingaverage(EMWA)modelfornon-
stationarydistributioninreal-timeenvironment.Thesolu-
tionproposedhasafewpointstobeconsidered.(1)Thedata
samplesmustbestoredfortuningandfutureuse,ifrequired
forthe,(2)thecurrentdataistherepresentation
ofnewknowledgewhichwouldbeusefulforadaptation,
(3)amechanismtodetecttheshiftinthedata,and(4)the
irrelevantdataisremovedthroughpruning.TheEMWA
approachhaslowcomputationalcostandlessmemoryis
requiredduringprocessingwhichgivesenhancedaccuracy
andshortertimedelayinthedetection.Inthissolution,
thestepistheestimateoftheactualshiftoccurred
whichisperformedbyEWMA.Ifthetestispositivethe
nextstageisactivatedwhichisthetest/validationstage,
wheretheshiftinthedataisdetectedandthenitis
validated.Oncethedetectionisthenextstepis
toadapt,forthisrofthe
isneeded.Anothermethodwasproposedwithcovariate
shiftandretrainingwiththecurrentknowledgebaseand
thenewknowledgebasewhichisobtainedfromthedelayin
theshiftdetection.Adaptivelearningwithnewknowledge
baseandadaptivelearningoncombinedknowledgebase
andcovariateshiftwasalsoproposed.
[2]Inthispaperaproposedmethodtotacklewith
thesimpledatasetshiftisbymatchingthecovariateshift
distributionsoftrainingandtestdatainahighdimensional
featurespace(KernelHilbertspace).Forthismethoddis-
tributionestimationisnotrequired.Instead,weightsare
obtainedwithquadraticprogramming.Itisseenthatwith
properlychoosingtheparametersandwiththecorrectionin
thecovariateshifttheandtheregressionmethods
couldInthispapervariousrealworlddatasetswere
usedandthesolutiondemonstratesthatbyusingKMMthe
learningperformanceisimproved.
[3]Inthispaperasolutionisproposedinwhichneither
thetrainingnorthetestareexplicitlymodelled.Adiscrimi-
nativemodelwasderivedforthedifferingtrainingandtest
distribution.Inthiseachtraininginstanceneedstoweighted
withitstest-to-trainingdensityratio.Thispaperdescribesa
DATASCIENCEANDDECISIONMAKING
2
generativemodelwheretheparametersareestimatedwith
aMAPhypothesisoftheparametersofthetest-to-train
andthe.Themainadvantagewiththissolution
iswithoutthepriorknowledgebycrossvalidationthe
regularizationparameterscanbetuned.
[4]Proposesamethodwhichestimatestheimportance
directlyfromthesampleswithoutgoingthroughthedensity
estimation.Withthismethodthecomputationtimeisin-
dependentofthetestsampleswhichisadvantageouswith
unlabelledsamples.Inthispapertherearevariousother
methodswhichobtainimportancewithoutgoingthrough
thedensityestimationlike,kernelmeanmatching,thelo-
gisticregressionmethodandKullback-Leiblerimportance
estimationprocedure(KLIEP).Itisseenthatforthelarge
datasamplesLogLinearKLIEPmodelthecomputational
timeiscomparativelylesserandisindependentofthetest
data
[5]proposesamethodcalledimportanceweightedcross
validation(IWCV)forwhichthedistributionmaintainsits
propertyofunbiasednessunderthecaseofcovariatedataset
shift.Fortheunbiasedtheonlymethodthat
canbeusedistheIWCVmethodtosolvetheproblemof
covariatedatasetshift.Forthismethodtheusefulnessis
shownthroughsimulationsanddemonstratedinthebrain-
computerinterface(BCI)wherethecovariateshiftcanbe
seeninthetrainingandthetestsessions.
3M
ETHODOLOGY
Therearevarioustechniquestotackletheproblemofdataset
shift.Thebasicandthestepisidentifyingthedrift
inthedatasetwhichisdoneasfollows;a)Preprocessing-
inthisstepthedataiscleanedbyimputingthemissing
valuesandconvertingthedatatypeslikecategoricalvalues
toacommontype,b)thenextstepistocreatearandom
sampleforthetrainingandthetestdatasetandthenadding
anewfeaturewhichhasthevaluedependingonthevalues
ofthedata,c)thenextstepistoconcatenatetherandom
samplesintoacommondataset.Caremustbetakento
seethatthedatasetisnotunbalancedI.e.thesizeofthe
trainingandthetestshouldbenearlyequal,d)thenextstep
istocreateamodelusinganyofchoiceandget
apredictiononthedataset,e)afterpredictingtheAUC-
ROCscoreisobtainedtocheckifthereisadriftinthe
dataornot,itisgenerallyconsideredafeaturewiththe
scorethatisgreaterthan0.80saystohaveadrift.There
arevariousmethodsfordetectingthechangesinthedata;
oneofthemostfamousmethodisbyusingthehistograms,
withwhichyoucancheckthechangesinmodelprediction
andalsoifthemostimportantcolumnsorfeaturesdrift.
Thedisadvantageofusingthehistogramoccurswhenthe
dataishighdimensionalorhassparsefeatures.Theother
metricswhichcouldalsobeusedtodetectthedriftare
Kullback-Leblerdivergence,PopulationStabilityIndex(PSI)
andKolmogorov-Smirnovstatistics.
Afteridentifyingthedriftindataset,itcanbeused
withdifferenttechniquestoimprovetheandmaintainthe
unbiasedproperty.Onesuchtechniquethatcouldbeused
is;afteridentifyingthedriftinthefeaturesofthedatasetthe
columnsorthefeaturesthathaveadriftcanbedropped.
Thisisthesimplestmethodaswejustdropthefeatures
thathaveadrift,buttheproblemwiththismethodisthe
featureswithimportantinformationwouldbelost.An-
othermethodisimportanceweightusingtheDensityRatio
Estimation.Inthismethodthetrainingandtestdensities
areseparatelyestimatedandthentheimportanceis
estimatedbytheratiooftheestimateddensitiesoftrain
andthetest.Thesewillnowbeusedasweightsforevery
instanceintrainingdataset.Theproblemwiththistechnique
is;inhigherdimensionaldatasetsgivingimportancetoeach
instancewouldbetimeconsuming.Ifthefeaturesorthe
columnsinthedatasetarelarger,thenthetimetakento
completethetaskisverymuchhigh.
Inthiswork,wewillbeusingdifferenttechniquesbut
mainlyfocusontheKernelMeanMatching(KMM)method.
Inthistechniquethecovariateshiftismatchedwiththedata
inahigherdimension(kernelHilbertspace).Inthismethod
thereisnoneedfordistributionestimationandthesample
weightsareobtainedbyquadraticprogramming.Andwill
bemodeledusingasingleclassSVM.
Thereare2datasetsthatareusedforthisprojectwhich
aregotfromKagglewhichareasfollows;GoogleAna-
lyticsCustomerRevenuePredictionandotheristhedata
ofSantanderCustomerTransactionprediction.Asthese
datasetsisfromthecustomerrevenuemostofthefeatures
arenumericandhenceacovariateshiftisexpected.Both
thedatasetshaveasilargenumberoffeatures.
ThisdatawassubjectedtoPreprocessingwherethe
datawascheckedforanyirregularitieslikeblankspaces
oranycategoricalvalues.ForthedatafromtheSantander
customertransactiontherewasnoirregularitywasfound
onlythetwocolumnsweredeletedwhichdidnothave
anyimpactonthedataandwasnotimportant
informationasaresultwasdeleted.Thetrainandthe
testwerethendividedandthenwasdividedandthen
concatenatedandapredictivemodelwithaDecisionTree
wasemployedtopredictthemodel.Thescorewas
calculatedusingtheAUC-ROCmetric.Theebelow
showsthehistogramofsomeofthefeatures.
Fig.2.HistogramillustrationfortheSantanderCustomerdataset
Similarly,withtheseconddatasetthepreprocessingwas
carriedout.Sincethedatawascleantherewasnoneedfor
cleaning.SincetheDecisionTreeisusedherethe
categoricalvaluesinthedatadonotmakeadifferenceand
arenotremoved.Ifadifferenttypeofwasmaybe
used,thentherewouldariseaproblemwithcategorical
DATASCIENCEANDDECISIONMAKING
3
values.Forboththedatasetshistogramswereplottedto
checkthecovariatedatashift.Theebelowshowsthe
histogramofsomeofthefeatures.
Fig.3.HistogramillustrationfortheGoogleAnalysisdataset
4R
ESULTS
ThedatasetsweresubjectedtoaDecisionTreefor
thepredictionandtoevaluatethemodelperformancethe
AUC-ROCscorewasevaluated.Thisscoregivesageneral
goodideaofhowthemodelperforms.Theresultsshowed
thattherewasacovariateshiftinthedatasets.FortheAUC-
ROCscoreifitiscalculatedasgreaterthan0.80,thenit
isconsideredasahighcovariateshift.Forthedatawith
theSantanderCustomerstherewasseenaconsiderable
covariateshiftin14ofthefeatures.
5D
ISCUSSIONS
FirstthedataobtainedissubjectedtoPreprocessingto
cleanthedatafromirregularities.Afterthecleaningofthe
dataisthensubjectedtodetection,whichchecksforthe
covariateshiftinthedata.Thiscouldbedonebyhistogram
visualizationoranyofthemethodsasdiscussedearlier.The
Covariateshiftindatacanbeevaluatedbyevaluatingthe
AUC-ROCscore,whichsaysthatifthescoreisgreaterthan
0.80thenthereisacovariateshift,ifthescoreisaround
0.50itmeansitdoesnothaveanychangeinthedataand
nocovariateshiftisthedatasetandifliesbetween0.70to
0.80itcouldbesaidthatthereissomedegreeofcovariate
shiftinthedataset.Ifthedataisofhigherdimensions,then
theprocessofdimensionreductioniscarriedout.Sincethe
scoreforthedatasetSantanderCustomersisaround0.50
forAUC-ROCitcanbeconsideredthatthereisnocovariate
shift.AndfortheGoogleanalysistherewere14featuresthat
covariateinnature.
Ifthereisnocovariateshift,thentheproblemwiththe
datasetshiftisnotlikelytocomeup.Butforthedatawith
covariateshifttheKernelMeanMatchingmethodorany
othertechniquecouldbeappliedtomaintaintheproperty
oftheasunbiasedness.
6C
ONCLUSION
Machinelearningisathatcanbeconsideredasthe
intersectionofstatisticsandcomputingscience.Machine
learningcanbeseeninalmosteveryaspectofbusiness,
engineering,medicalscienceandsoon.Inapredictive
learningmodel,themostcommonproblemthatisencoun-
teredisthedatasetshiftproblem.Thisproblemwasignored
whichleadtowrongpredictions.Intherecentfewyearsthis
problemreceivedagrowingamountofinterest.
R
EFERENCES
[1]H.Raza,G.Prasad,andY.Li,
Adaptivelearningwithcovariateshift-
detectionfornon-stationaryenvironments
,in201414thUKWorkshop
onComputationalIntelligence(UKCI).IEEE,2014,pp.1Œ8.
[2]A.Gretton,AJ.Smola,J.Huang,M.Schmittfull,KM.Borgwardt,
andB.Scholkopf,
Covariateshiftandlocallearningbydistribution
matching
,pages131Œ160.MITPress,Cambridge,MA,USA,2009.
[3]SteffenBickel,MichaelBruckner,TobiasScheffer,
Discriminative
LearningUnderCovariateShift
,JournalofMachineLearningRe-
search10(2009)2137-2155.
[4]Sugiyama,M.,Suzuki,T.,Nakajima,S.etal,
Directimportanceesti-
mationforcovariateshiftadaptation
,AnnInstStatMath60,699Œ746
(2008).
[5]MasashiSugiyama,MatthiasKrauledat,Klaus-Robert
M
¨
uller,
CovariateShiftAdaptationbyImportanceWeightedCross
Validation
,JournalofMachineLearningResearch8(2007)985-1005.
DATASCIENCEANDDECISIONMAKING
4
A
PPENDIX
A
P
ROJECT
P
LAN
Fig.4.Ganttchart
